from django.shortcuts import render,redirect
from django.http import HttpResponse
from django.views import generic
from django.contrib.auth.forms import UserCreationForm
from user.models import User
from .models import *
from .forms import CreateUserForm
from django.contrib import messages
from django.contrib.auth import authenticate,login,logout
from django.contrib.auth.decorators import login_required

# Create your views here.
def registerPage(request):
    createUserForm = CreateUserForm()
    if request.method =='POST':
         createUserForm = CreateUserForm(request.POST)
         
         if createUserForm.is_valid():
             createUserForm.save()
             username = createUserForm.cleaned_data.get("username")
             aa = User(name=username)
             aa.save()
             messages.success(request,"创建了"+username)
             return redirect('login')

    context={'createUserForm':createUserForm}
    return render(request,'apkupload/register/login.html',context)

def loginPage(request):
    context = {}
    if request.method =='POST':
        username = request.POST.get('username')
        password = request.POST.get('password')
        userown = authenticate(request,username=username,password=password)
        
        if userown is not None:
            login(request,userown)
            return redirect('apkupload')
        else:
            messages.info(request,'user or pass is incorrect')
            return redirect('login')
    
    return render(request,'apkupload/login/login.html',context)

@login_required(login_url='login')
def logoutUser(request):
    logout(request)
    return redirect('login')
